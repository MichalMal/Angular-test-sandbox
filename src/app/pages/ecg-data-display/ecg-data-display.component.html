<div class="container py-4">
  <div *ngIf="responseData._header">
    <div ngbAccordion>
      <div ngbAccordionItem>
        <h2 ngbAccordionHeader>
          <button ngbAccordionButton>{{responseData._header.patientId}}</button>
        </h2>
        <div ngbAccordionCollapse>
          <div ngbAccordionBody>
            <ng-template>
              <div class="row">
                <div class="col-6">
                  <p>version: {{responseData._header.dataFormat}}</p>
                  <p>Patient ID: {{responseData._header.patientId}}</p>
                  <p>Local ID: {{responseData._header.localRecordingId}}</p>
                  <p>Start DateTime: {{responseData._header.recordingDate}}</p>
                </div>
                <div class="col-6">
                  <p>Reserved: {{responseData._header.reserved}}</p>
                  <p>Number of records: {{responseData._header.nbDataRecords}}</p>
                  <p>Duration of a record: {{responseData._header.durationDataRecordsSec}}</p>
                  <p>Number of signals: {{responseData._header.nbSignals}}</p>
                </div>

              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<app-time-scale *ngIf="responseData._header" [timeScale]="timeScale"
  [dateTimeOfRecord]="responseData._header.recordingDate"
  (timeScaleChange)="onTimeScaleChange($event)"></app-time-scale>

<div class="chart-block container-fluid sticky-top bg-white" style="overflow-x: hidden;" *ngIf="responseData._header">
  <div #chart style="width: 100%; height: 400px;"></div>
</div>

<div class="container py-4" *ngIf="responseData._header">
  <div class="card">
    <div class="card-header">
      <div class="row">
        <div class="col">
          <b>{{responseData._header.signalInfo[selectedSeriesIndex].label}}</b>
        </div>
        <div class="col text-end" *ngIf="averageHr !== 0 && brushStrokes[selectedSeriesIndex].length !== 1 && brushStrokes[selectedSeriesIndex].length !== 0">
          <span><i class="bi bi-heart-pulse-fill text-danger"></i> {{averageHr}} bpm</span>
        </div>
      </div>
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item border border-2 border-primary" [ngClass]="{'border-top-0': i !== 0 }"
        *ngFor="let brush of brushStrokes[selectedSeriesIndex]; index as i" (mouseover)="higlightQT(i)" (mouseout)="dimmQT(i)">
        <h5><i class="bi bi-distribute-horizontal text-success"></i> QT Interval {{i+1}} - {{brush.endTime - brush.startTime}} ms</h5>
        <hr>
        <div class="row">
          <div class="col">
            <div class="row">
              <label for="start-time-{{i}}" class="col-md-3 col-form-label text-center">Start Time: </label>
              <div class="col-md-9">
                <input type="number" class="form-control" id="start-time-{{i}}"
                  [(ngModel)]="brushStrokes[selectedSeriesIndex][i]['startTime']"
                  (change)="onIntervalTimeChange(brushStrokes[selectedSeriesIndex])" />
              </div>
            </div>
          </div>
          <div class="col-1 d-flex align-items-center justify-content-center">
            <i class="bi bi-activity text-primary"></i>
          </div>
          <div class="col">
            <div class="row">
              <label for="end-time-{{i}}" class="col-md-3 col-form-label text-center">End Time: </label>
              <div class="col-md-9">
                <input type="number" class="form-control" id="end-time-{{i}}"
                  [(ngModel)]="brushStrokes[selectedSeriesIndex][i]['endTime']"
                  (change)="onIntervalTimeChange(brushStrokes[selectedSeriesIndex])" />
              </div>
            </div>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col" *ngIf="brush.Qtc[1]">
            <b class="text-success">Bazett Qtc:</b> {{brush.Qtc[1]}} ms
          </div>
          <div class="col" *ngIf="brush.Qtc[2]">
            <b class="text-success">Framingham Qtc:</b> {{brush.Qtc[2]}} ms
          </div>
          <div class="col" *ngIf="brush.Qtc[3]">
            <b class="text-success">Fridericia Qtc:</b> {{brush.Qtc[3]}} ms
          </div>
        </div>
      </li>
    </ul>
  </div>

</div>


<div *ngIf="isLoading" class="loading-screen">
  <p>Loading...</ p>
</div>